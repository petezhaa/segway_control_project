#---------------------------------------------------------------
# 1 Read in RTL source files (SystemVerilog)
#---------------------------------------------------------------
read_file -format sverilog { A2D_intf.sv Auth_blk.sv balance_cntrl.sv inert_intf.sv inertial_integrator.sv mtr_drv.sv PID.sv piezo_drv.sv PWM11.sv rst_synch.sv Segway.sv SegwayMath.sv SPI_mnrch.sv UART_rx.sv steer_en.sv steer_en_SM.sv }

current_design Segway

#---------------------------------------------------------------
# 2 Create 333 MHz clock on port "clk"
#    333 MHz -> period = 1 / 333e6 = 3 ns
#---------------------------------------------------------------
create_clock -name clk -period 3 [get_ports clk]

#---------------------------------------------------------------
# 3 Do not let DC optimize/buffer through the clock tree
#---------------------------------------------------------------
set_dont_touch_network [get_ports clk]

#---------------------------------------------------------------
# 4 Constrain INPUTS (except clk) with 0.25 ns input delay
#    - collect all primary inputs
#    - remove the clock port
#---------------------------------------------------------------
set prim_inputs [remove_from_collection [all_inputs] [get_ports clk]]
set_input_delay -clock clk 0.25 $prim_inputs

#---------------------------------------------------------------
# 5 Constrain OUTPUTS
#    - output delay 0.35 ns w.r.t. clk
#    - 50 fF (= 0.05 pF) load on all outputs
#---------------------------------------------------------------
set_output_delay -clock clk 0.35 [all_outputs]
set_load 0.05 [all_outputs]

#---------------------------------------------------------------
# 6 Define input drive strength
#---------------------------------------------------------------
set_driving_cell  \
  -lib_cell NAND2X2_RVT \
  -library saed32rvt_tt0p85v25c \
  $prim_inputs

#---------------------------------------------------------------
# 7 Global electrical constraints
#    - max transition on *all* nets/nodes: 0.10 ns
#    - use Synopsys 32nm wire load model for 16000 sq. microns
#---------------------------------------------------------------
set_max_transition 0.10 [current_design]
set_wire_load_model -name 16000 -library saed32rvt_tt0p85v25c

#---------------------------------------------------------------
# 8 set clk uncertainty (0.15 ns)
#---------------------------------------------------------------
set_clock_uncertainty 0.15 clk

#---------------------------------------------------------------
# 9  Multi-cycle path constraints for iNEMO 
#    (and maybe soft-start timer)
#---------------------------------------------------------------
#set_multicycle_path 2 -setup -from [find pin iNEMO/ptch_*_reg*/clk]
#set_multicycle_path 2 -setup -from [find pin iNEMO/AZ*/CLK]
#set_multicycle_path 2 -hold -from [find pin iNEMO/ptch_rt_*/CLK]
#set_multicycle_path 2 -hold -from [find pin iNEMO/AZ*/CLK]
#set_multicycle_path 2 –setup –from [find pin iBAL/iCNTRL/ss_tmr_reg*/CLK]
#set_multicycle_path 2 –hold –from [find pin iBAL/iCNTRL/ss_tmr_reg*/CLK]

set_multicycle_path 2 -setup -from [get_pins {iNEMO/ptch_*_reg*/CLK}]
set_multicycle_path 2 -setup -from [get_pins {iNEMO/AZ*/CLK}]
set_multicycle_path 2 -hold -from [get_pins {iNEMO/AZ*/CLK}]
set_multicycle_path 2 -hold -from [get_pins {iNEMO/ptch_*_reg*/CLK}]



#---------------------------------------------------------------
# 10 First pass compile
#---------------------------------------------------------------
compile -map_effort medium

#---------------------------------------------------------------
# 11 Fix holds on the clock if DC sees min-path issues
#    (this is a common step after first timing pass)
#---------------------------------------------------------------
set_fix_hold clk

#---------------------------------------------------------------
# 12 Flatten hierarchy
#     ungroup -all -flatten turns the current design into 1 level.
#---------------------------------------------------------------
ungroup -all -flatten

#---------------------------------------------------------------
# 13 Second pass compile on flat netlist
#---------------------------------------------------------------
compile -map_effort medium

report_timing -delay min
report_timing -delay max

report_area
write -format verilog -output segway.vg